<!DOCTYPE html>
<html>
<head lang="en">
  <meta charset="UTF-8">
  <title>Kidcompy test harness</title>
</head>
<body>
  Kidcompy Harness!

  <div id="test"></div>

  <!-- Write the webpack hot dev server script tag.  URL needs to be full and not relative, that's why it is built
       using the window.location.href's URL as the base -->
  <script type="text/javascript">
    // Legacy IE can be a real pain when it comes to console.log, so just make a dummy if it does not
    // exist at startup
    if(!window.console) {
      window.console = {};
    }
    if(!console.log) {
      console.log = function() {}
    }
    if(!console.group) {
      console.group = function() {}
    }
    if(!console.groupCollapsed) {
      console.groupCollapsed = function() {}
    }
    if(!console.groupEnd) {
      console.groupEnd = function() {}
    }
  </script>

  <script type="text/javascript" src="harness.js"></script>

  <script type="text/javascript">
    // wait for kidcompy to appear before trying to register for the onCodeGo event
    kidcompy.lifecycleEvents.addOnCodeGoHandler(function() {
      var pageUrl = "" + window.location.href,
        devServerUrl = /([^\:]+\:\/\/[^\/]+\/).*/.exec(pageUrl)[1] + "webpack-dev-server.js",
        scriptTag = document.createElement("script"),
        kidcompyHost;

      scriptTag.setAttribute("type", "text/javascript");
      scriptTag.setAttribute("src", devServerUrl);
      document.getElementsByTagName("head")[0].appendChild(scriptTag);
      scriptTag = null;

      kidcompyHost = new kidcompy.KidcompyHost("test");
      kidcompyHost.flipBuffers[0].playfields[0].fillRectangle(0, 0, 10, 10, "#0000ff");
      kidcompyHost.flipBuffers[0].playfields[0].fillRectangle(10, 10, 10, 10, "#00ff00");
      kidcompyHost.flipBuffers[0].playfields[0].fillRectangle(20, 20, 10, 10, "#ff0000");
    });
  </script>
</body>
</html>
